<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –Ω–∞—Ä—Ü–∏—Å—Å–∏–∑–º–∞, –Ω–µ—Ä–≤–æ–∑–Ω–æ—Å—Ç–∏ –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏.">
  <title>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç: –ü—É—Ç—å –∫ —Å–∞–º–æ–ø–æ–Ω–∏–º–∞–Ω–∏—é</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #ffffff;
      color: #1a202c;
      line-height: 1.7;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 24px;
      overflow-x: hidden;
    }

    .container {
      background: #ffffff;
      border-radius: 24px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
      max-width: 900px;
      width: 100%;
      padding: 48px;
      margin: 24px;
      transition: transform 0.4s ease, box-shadow 0.4s ease;
      position: relative;
      animation: fadeInContainer 0.8s ease;
    }

    .container:hover {
      transform: translateY(-6px);
      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.12);
    }

    h1 {
      color: #2d3748;
      font-size: 34px;
      font-weight: 700;
      margin-bottom: 16px;
      text-align: center;
    }

    h2 {
      color: #4a5568;
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 24px;
      text-align: center;
    }

    p {
      color: #718096;
      font-size: 16px;
      margin-bottom: 32px;
      text-align: center;
    }

    .btn {
      background: linear-gradient(90deg, #4299e1, #9f7aea);
      color: #ffffff;
      padding: 14px 40px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 8px;
      position: relative;
      overflow: hidden;
    }

    .btn:hover, .btn:focus {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      outline: none;
    }

    .btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.4s ease, height 0.4s ease;
    }

    .btn:active::after {
      width: 200px;
      height: 200px;
    }

    .question {
      margin: 40px 0;
      text-align: left;
      animation: slideInQuestion 0.5s ease;
    }

    .question p {
      font-size: 20px;
      font-weight: 500;
      color: #2d3748;
      margin-bottom: 20px;
    }

    .options {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 16px;
      animation: fadeInOptions 0.6s ease;
    }

    .option {
      background: #f7fafc;
      padding: 14px 28px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
      text-align: center;
      min-width: 80px;
      max-width: 200px;
      position: relative;
    }

    .option:hover, .option:focus {
      background: #e2e8f0;
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .option.selected {
      background: #9f7aea;
      color: #ffffff;
    }

    .tooltip {
      position: absolute;
      background: #2d3748;
      color: #ffffff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      top: -30px;
      left: 50%;
      transform: translateX(-50%);
      display: none;
      z-index: 10;
    }

    .option:hover .tooltip, .option:focus .tooltip {
      display: block;
    }

    .progress-container {
      margin-bottom: 32px;
      text-align: center;
      position: relative;
    }

    .progress-circle {
      width: 80px;
      height: 80px;
      margin: 0 auto;
    }

    .progress-circle svg {
      transform: rotate(-90deg);
    }

    .progress-circle circle {
      fill: none;
      stroke: #e2e8f0;
      stroke-width: 8;
    }

    .progress-circle .progress {
      stroke: url(#progressGradient);
      stroke-width: 8;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.5s ease;
    }

    .progress-text {
      font-size: 14px;
      color: #718096;
      margin-top: 12px;
      font-weight: 500;
    }

    .results {
      margin-top: 32px;
    }

    .result-block {
      background: #f7fafc;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 20px;
      transition: transform 0.3s ease;
    }

    .result-block:hover {
      transform: translateY(-4px);
    }

    .result-block h3 {
      color: #2d3748;
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 16px;
    }

    .result-bar {
      height: 20px;
      border-radius: 10px;
      margin-top: 16px;
      transition: width 0.6s ease;
    }

    .narcissism { background: #9f7aea; }
    .nervousness { background: #4299e1; }
    .emotional { background: #b794f4; }

    .recommendation {
      font-size: 15px;
      color: #4a5568;
      margin-top: 16px;
      line-height: 1.8;
    }

    .chart-container {
      margin: 32px 0;
      padding: 24px;
      background: #f7fafc;
      border-radius: 12px;
      text-align: center;
    }

    canvas {
      max-width: 100%;
      height: auto;
    }

    .export-btn, .share-btn {
      background: #4a5568;
    }

    .export-btn:hover, .share-btn:hover {
      background: #2d3748;
    }

    .reaction-test {
      margin: 40px 0;
      text-align: center;
    }

    .reaction-btn {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: #e2e8f0;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 16px;
      position: relative;
    }

    .reaction-btn.active {
      background: #9f7aea;
      animation: pulse 1s infinite;
    }

    .reaction-btn.shape {
      border-radius: 0;
    }

    .ranking-options {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding: 20px;
      background: #f7fafc;
      border-radius: 10px;
    }

    .ranking-option {
      background: #ffffff;
      padding: 12px;
      border-radius: 8px;
      cursor: move;
      transition: transform 0.2s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .ranking-option.dragging {
      opacity: 0.5;
      transform: scale(0.95);
    }

    .reflection-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      margin-top: 20px;
      resize: vertical;
    }

    .mood-tracker {
      margin: 20px 0;
      padding: 20px;
      background: #f7fafc;
      border-radius: 12px;
      text-align: center;
    }

    .mood-option {
      display: inline-block;
      margin: 8px;
      cursor: pointer;
      font-size: 24px;
    }

    .mood-option.selected {
      transform: scale(1.2);
    }

    .breathing-animation {
      margin: 40px auto;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #4299e1;
      animation: breathe 4s ease-in-out infinite;
      display: none;
    }

    .loader {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: radial-gradient(circle, #9f7aea, #4299e1);
      animation: ripple 1.5s infinite;
      display: none;
    }

    @keyframes fadeInContainer {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    @keyframes slideInQuestion {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes fadeInOptions {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    @keyframes breathe {
      0% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.3); opacity: 1; }
      100% { transform: scale(1); opacity: 0.8; }
    }

    @keyframes ripple {
      0% { transform: scale(1); opacity: 0.5; }
      100% { transform: scale(2); opacity: 0; }
    }

    @media (max-width: 600px) {
      .container {
        padding: 24px;
        margin: 16px;
      }

      h1 {
        font-size: 28px;
      }

      h2 {
        font-size: 20px;
      }

      .question p {
        font-size: 18px;
      }

      .options {
        flex-direction: column;
        gap: 12px;
      }

      .option {
        padding: 12px;
        font-size: 15px;
        max-width: none;
      }

      .btn {
        padding: 12px 32px;
        font-size: 15px;
      }

      .result-block {
        padding: 16px;
      }

      .reaction-btn {
        width: 80px;
        height: 80px;
      }
    }

    [aria-hidden="true"] {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container" id="app" role="main">
    <div class="loader" id="loader"></div>
    <div id="start-screen">
      <h1>–ü—É—Ç—å –∫ —Å–∞–º–æ–ø–æ–Ω–∏–º–∞–Ω–∏—é</h1>
      <h2>–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç</h2>
      <p>–ü–æ–≥—Ä—É–∑–∏—Ç–µ—Å—å –≤ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –∫ —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏—é —Å —ç—Ç–∏–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º —Ç–µ—Å—Ç–æ–º. –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ 50 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –≤–∞—à–µ–π —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏, —É—Ä–æ–≤–Ω—è —Å—Ç—Ä–µ—Å—Å–∞ –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è. –í–∞—à–∏ —á—É–≤—Å—Ç–≤–∞ ‚Äî —ç—Ç–æ –∫–ª—é—á –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –≥–∞—Ä–º–æ–Ω–∏–∏.</p>
      <div class="mood-tracker">
        <p>–ö–∞–∫–æ–µ —É –≤–∞—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–µ–π—á–∞—Å?</p>
        <span class="mood-option" onclick="selectMood('üòä')" role="button" aria-label="–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: —Å—á–∞—Å—Ç–ª–∏–≤–æ–µ">üòä</span>
        <span class="mood-option" onclick="selectMood('üòê')" role="button" aria-label="–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ">üòê</span>
        <span class="mood-option" onclick="selectMood('üòî')" role="button" aria-label="–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: –≥—Ä—É—Å—Ç–Ω–æ–µ">üòî</span>
      </div>
      <button class="btn" onclick="startTest()" aria-label="–ù–∞—á–∞—Ç—å –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>
    </div>
    <div id="quiz-screen" aria-hidden="true">
      <div class="progress-container">
        <div class="progress-circle">
          <svg width="80" height="80">
            <defs>
              <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" style="stop-color:#4299e1" />
                <stop offset="100%" style="stop-color:#9f7aea" />
              </linearGradient>
            </defs>
            <circle cx="40" cy="40" r="36" />
            <circle class="progress" id="progress" cx="40" cy="40" r="36" stroke-dasharray="226" stroke-dashoffset="226" />
          </svg>
        </div>
        <p class="progress-text" id="progress-text">–ó–∞–¥–∞–Ω–∏–µ 1 –∏–∑ 50</p>
      </div>
      <div class="question" id="question" role="region" aria-live="polite"></div>
      <div class="options" id="options" role="radiogroup"></div>
      <div class="reaction-test" id="reaction-test" aria-hidden="true">
        <p id="reaction-prompt"></p>
        <button class="reaction-btn" id="reaction-btn" onclick="recordReaction()" aria-label="–ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∞ —Ä–µ–∞–∫—Ü–∏–∏"></button>
      </div>
      <div class="ranking-options" id="ranking-options" aria-hidden="true" role="listbox"></div>
      <textarea class="reflection-input" id="reflection-input" aria-hidden="true" placeholder="–û–ø–∏—à–∏—Ç–µ —Å–≤–æ–∏ –º—ã—Å–ª–∏..." aria-label="–ü–æ–ª–µ –¥–ª—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏"></textarea>
      <div class="breathing-animation" id="breathing-animation" aria-hidden="true"></div>
      <button class="btn" id="next-btn" style="display: none;" onclick="nextQuestion()" aria-label="–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É">–î–∞–ª–µ–µ</button>
    </div>
    <div id="result-screen" aria-hidden="true">
      <h1>–í–∞—à–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h1>
      <h2>–í–∞—à –ø—É—Ç—å –∫ —Å–∞–º–æ–ø–æ–Ω–∏–º–∞–Ω–∏—é</h2>
      <p>–≠—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Äî –≤–∞—à –ª–∏—á–Ω—ã–π –∫–æ–º–ø–∞—Å –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å–µ–±—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö, —á—Ç–æ–±—ã –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ —Å–≤–æ—ë–º –º–µ–Ω—Ç–∞–ª—å–Ω–æ–º –∑–¥–æ—Ä–æ–≤—å–µ –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∞–ª–∞–Ω—Å.</p>
      <div class="chart-container">
        <canvas id="result-chart" role="img" aria-label="–†–∞–¥–∞—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∞"></canvas>
      </div>
      <div class="results" id="results"></div>
      <button class="btn export-btn" onclick="exportResults()" aria-label="–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ HTML">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
      <button class="btn share-btn" onclick="shareResults()" aria-label="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
      <button class="btn" onclick="restartTest()" aria-label="–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç –∑–∞–Ω–æ–≤–æ">–ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ</button>
    </div>
  </div>

  <script>
    const questions = [
      { type: "likert", text: "–ú–Ω–µ –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –æ–∫—Ä—É–∂–∞—é—â–∏–µ –≤–æ—Å—Ö–∏—â–∞–ª–∏—Å—å –º–Ω–æ–π", category: "narcissism", tooltip: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –≤–Ω–µ—à–Ω–µ–º—É –ø—Ä–∏–∑–Ω–∞–Ω–∏—é" },
      { type: "likert", text: "–Ø —á–∞—Å—Ç–æ —á—É–≤—Å—Ç–≤—É—é –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–æ –±–µ–∑ –≤–∏–¥–∏–º–æ–π –ø—Ä–∏—á–∏–Ω—ã", category: "nervousness", tooltip: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏" },
      { type: "likert", text: "–Ø —Å–∫–ª–æ–Ω–µ–Ω —Å–∫—Ä—ã–≤–∞—Ç—å —Å–≤–æ–∏ –Ω–∞—Å—Ç–æ—è—â–∏–µ —á—É–≤—Å—Ç–≤–∞", category: "emotional", tooltip: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å" },
      { type: "likert", text: "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –¥—Ä—É–≥–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ü–µ–Ω—è—Ç –º–µ–Ω—è", category: "narcissism", tooltip: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ –≤–Ω–µ—à–Ω–µ–π –æ—Ü–µ–Ω–∫–∏" },
      { type: "likert", text: "–£ –º–µ–Ω—è –±—ã–≤–∞—é—Ç —Ä–µ–∑–∫–∏–µ –ø–µ—Ä–µ–ø–∞–¥—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è", category: "emotional", tooltip: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å" },
      { type: "reaction", text: "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω–∞ —Å—Ç–∞–Ω–µ—Ç —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–π.", category: "nervousness", reactionType: "color", tooltip: "–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–∞–∫—Ü–∏–∏" },
      { type: "likert", text: "–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –±—ã—Ç—å –≤ —Ü–µ–Ω—Ç—Ä–µ –≤–Ω–∏–º–∞–Ω–∏—è", category: "narcissism", tooltip: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤–æ –≤–Ω–∏–º–∞–Ω–∏–∏" },
      { type: "likert", text: "–Ø —á–∞—Å—Ç–æ –ø–µ—Ä–µ–∂–∏–≤–∞—é –∏–∑-–∑–∞ –º–µ–ª–æ—á–µ–π", category: "nervousness", tooltip: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ —Ç—Ä–µ–≤–æ–≥–µ" },
      { type: "likert", text: "–Ø –ª–µ–≥–∫–æ —Å–ø—Ä–∞–≤–ª—è—é—Å—å —Å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏", category: "emotional", reverse: true, tooltip: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å" },
      { type: "multiple", text: "–ö–∞–∫ –≤—ã —Ä–µ–∞–≥–∏—Ä—É–µ—Ç–µ –Ω–∞ –∫—Ä–∏—Ç–∏–∫—É?", category: "narcissism", options: [
        { text: "–ü—Ä–∏–Ω–∏–º–∞—é —Å–ø–æ–∫–æ–π–Ω–æ", score: 1 },
        { text: "–ß—É–≤—Å—Ç–≤—É—é —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ, –Ω–æ –º–æ–ª—á—É", score: 3 },
        { text: "–û–ø—Ä–∞–≤–¥—ã–≤–∞—é—Å—å –∏–ª–∏ —Å–ø–æ—Ä—é", score: 5 }
      ], tooltip: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ –∫—Ä–∏—Ç–∏–∫—É" },
      { type: "likert", text: "–Ø —á–∞—Å—Ç–æ —á—É–≤—Å—Ç–≤—É—é —É—Å—Ç–∞–ª–æ—Å—Ç—å –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã", category: "nervousness" },
      { type: "likert", text: "–ú–æ–∏ —ç–º–æ—Ü–∏–∏ —á–∞—Å—Ç–æ –≤—ã—Ö–æ–¥—è—Ç –∏–∑-–ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª—è", category: "emotional" },
      { type: "truefalse", text: "–Ø —Å—á–∏—Ç–∞—é —Å–µ–±—è –æ—Å–æ–±–µ–Ω–Ω—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º", category: "narcissism", trueScore: 5, falseScore: 1, tooltip: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å–∞–º–æ–æ—Ü–µ–Ω–∫—É" },
      { type: "likert", text: "–Ø —á–∞—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—é, –≤—Å—ë –ª–∏ —è —Å–¥–µ–ª–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ", category: "nervousness" },
      { type: "likert", text: "–Ø —Ä–µ–¥–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞—é —Å–≤–æ–∏ —Å–ª–∞–±–æ—Å—Ç–∏ –æ–∫—Ä—É–∂–∞—é—â–∏–º", category: "emotional" },
      { type: "ranking", text: "–†–∞—Å—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: —á—Ç–æ –¥–ª—è –≤–∞—Å –≤–∞–∂–Ω–µ–µ?", category: "narcissism", options: [
        { text: "–õ–∏—á–Ω–æ–µ –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ", score: 5 },
        { text: "–ü–æ–º–æ—â—å –¥—Ä—É–≥–∏–º", score: 1 },
        { text: "–õ–∏—á–Ω—ã–π –∫–æ–º—Ñ–æ—Ä—Ç", score: 3 }
      ], tooltip: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã" },
      { type: "likert", text: "–Ø —á–∞—Å—Ç–æ —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ –≤ –æ–±—â–µ—Å—Ç–≤–µ", category: "nervousness" },
      { type: "likert", text: "–Ø –º–æ–≥—É –ª–µ–≥–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É —ç–º–æ—Ü–∏—è–º–∏", category: "emotional", reverse: true },
      { type: "reaction", text: "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É, –∫–æ–≥–¥–∞ –æ–Ω–∞ —Å—Ç–∞–Ω–µ—Ç –∫–≤–∞–¥—Ä–∞—Ç–æ–º.", category: "nervousness", reactionType: "shape", tooltip: "–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–∞–∫—Ü–∏–∏" },
      { type: "likert", text: "–Ø —á–∞—Å—Ç–æ –ø—Ä–æ—Å—ã–ø–∞—é—Å—å —Å —á—É–≤—Å—Ç–≤–æ–º —Ç—Ä–µ–≤–æ–≥–∏", category: "nervousness" },
      { type: "likert", text: "–ú–Ω–µ —Ç—Ä—É–¥–Ω–æ –¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º–∏ —á—É–≤—Å—Ç–≤–∞–º–∏", category: "emotional" },
      { type: "multiple", text: "–ß—Ç–æ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ, –∫–æ–≥–¥–∞ –ø–ª–∞–Ω—ã —Ä—É—à–∞—Ç—Å—è?", category: "emotional", options: [
        { text: "–ë—ã—Å—Ç—Ä–æ –∞–¥–∞–ø—Ç–∏—Ä—É—é—Å—å", score: 1 },
        { text: "–ù–µ–º–Ω–æ–≥–æ —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞—é—Å—å", score: 3 },
        { text: "–°–∏–ª—å–Ω–æ –ø–µ—Ä–µ–∂–∏–≤–∞—é", score: 5 }
      ]},
      { type: "likert", text: "–Ø —á–∞—Å—Ç–æ —á—É–≤—Å—Ç–≤—É—é –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ", category: "nervousness" },
      { type: "likert", text: "–Ø –º–æ–≥—É —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –≤ —Å—Ç—Ä–µ—Å—Å–æ–≤—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö", category: "emotional", reverse: true },
      { type: "likert", text: "–Ø —á–∞—Å—Ç–æ –¥—É–º–∞—é –æ —Ç–æ–º, –∫–∞–∫ –≤—ã–≥–ª—è–∂—É –≤ –≥–ª–∞–∑–∞—Ö –¥—Ä—É–≥–∏—Ö", category: "narcissism" },
      { type: "reflection", text: "–û–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é, –∫–æ–≥–¥–∞ –≤—ã —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ —Å–µ–±—è –Ω–µ–¥–æ–æ—Ü–µ–Ω—ë–Ω–Ω—ã–º. –ö–∞–∫ –≤—ã —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª–∏?", category: "narcissism", tooltip: "–û—Ü–µ–Ω–∏–≤–∞–µ—Ç –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ –æ—Ü–µ–Ω–∫–∏" },
      { type: "likert", text: "–ú–µ–Ω—è –ª–µ–≥–∫–æ –≤—ã–≤–µ—Å—Ç–∏ –∏–∑ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è", category: "nervousness" },
      { type: "likert", text: "–Ø —Ä–µ–¥–∫–æ –ø–æ–∑–≤–æ–ª—è—é —ç–º–æ—Ü–∏—è–º –≤–ª–∏—è—Ç—å –Ω–∞ –º–æ–∏ —Ä–µ—à–µ–Ω–∏—è", category: "emotional", reverse: true },
      { type: "likert", text: "–Ø –ª—é–±–ª—é, –∫–æ–≥–¥–∞ –º–Ω–æ–π –≤–æ—Å—Ö–∏—â–∞—é—Ç—Å—è", category: "narcissism" },
      { type: "likert", text: "–Ø —á–∞—Å—Ç–æ —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –ø–æ–¥–∞–≤–ª–µ–Ω–Ω—ã–º", category: "nervousness" },
      { type: "likert", text: "–ú–Ω–µ —Ç—Ä—É–¥–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –¥–∞–∂–µ –±–ª–∏–∑–∫–∏–º –ª—é–¥—è–º", category: "emotional" },
      { type: "multiple", text: "–ö–∞–∫ –≤—ã —Ä–µ–∞–≥–∏—Ä—É–µ—Ç–µ –Ω–∞ –ø–æ—Ö–≤–∞–ª—É?", category: "narcissism", options: [
        { text: "–ü—Ä–∏—è—Ç–Ω–æ, –Ω–æ –Ω–µ –ø—Ä–∏–¥–∞—é –∑–Ω–∞—á–µ–Ω–∏—è", score: 1 },
        { text: "–†–∞–¥—É—é—Å—å –∏ –∂–¥—É –µ—â—ë", score: 3 },
        { text: "–°—á–∏—Ç–∞—é, —á—Ç–æ —ç—Ç–æ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ", score: 5 }
      ]},
      { type: "likert", text: "–Ø —á–∞—Å—Ç–æ –≤–æ–ª–Ω—É—é—Å—å –ø–µ—Ä–µ–¥ –≤–∞–∂–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏", category: "nervousness" },
      { type: "likert", text: "–Ø –±—ã—Å—Ç—Ä–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Å—å –ø–æ—Å–ª–µ —Å—Ç—Ä–µ—Å—Å–∞", category: "emotional", reverse: true },
      { type: "likert", text: "–Ø —á—É–≤—Å—Ç–≤—É—é, —á—Ç–æ –º–æ–∏ —É—Å–ø–µ—Ö–∏ –Ω–µ–¥–æ–æ—Ü–µ–Ω–∏–≤–∞—é—Ç", category: "narcissism" },
      { type: "reaction", text: "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω–∞ —Å—Ç–∞–Ω–µ—Ç —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–π.", category: "nervousness", reactionType: "color" },
      { type: "likert", text: "–Ø —á–∞—Å—Ç–æ —á—É–≤—Å—Ç–≤—É—é —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –º–µ–ª–æ—á–∞–º", category: "nervousness" },
      { type: "likert", text: "–Ø –º–æ–≥—É –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ —ç–º–æ—Ü–∏–∏ –≤ –ª—é–±–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏", category: "emotional", reverse: true },
      { type: "truefalse", text: "–ú–Ω–µ –≤–∞–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –ø–æ—Ö–≤–∞–ª—É –∑–∞ —Å–≤–æ—é —Ä–∞–±–æ—Ç—É", category: "narcissism", trueScore: 5, falseScore: 1 },
      { type: "likert", text: "–Ø —á–∞—Å—Ç–æ —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –Ω–µ—Å–ø–æ–∫–æ–π–Ω–æ", category: "nervousness" },
      { type: "likert", text: "–Ø –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é —Å–∫—Ä—ã–≤–∞—Ç—å —Å–≤–æ–∏ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è", category: "emotional" },
      { type: "ranking", text: "–†–∞—Å—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å–æ —Å—Ç—Ä–µ—Å—Å–æ–º?", category: "nervousness", options: [
        { text: "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å", score: 1 },
        { text: "–†–∞–∑–≥–æ–≤–æ—Ä —Å –¥—Ä—É–∑—å—è–º–∏", score: 3 },
        { text: "–û–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ", score: 5 }
      ]},
      { type: "likert", text: "–Ø —Å—á–∏—Ç–∞—é, —á—Ç–æ –º–æ–∏ –∏–¥–µ–∏ –ª—É—á—à–µ, —á–µ–º —É –¥—Ä—É–≥–∏—Ö", category: "narcissism" },
      { type: "likert", text: "–Ø —á–∞—Å—Ç–æ —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —É—è–∑–≤–∏–º—ã–º", category: "nervousness" },
      { type: "likert", text: "–Ø —Ä–µ–¥–∫–æ –ø–æ–∑–≤–æ–ª—è—é —ç–º–æ—Ü–∏—è–º —Ä—É–∫–æ–≤–æ–¥–∏—Ç—å –º–Ω–æ–π", category: "emotional", reverse: true },
      { type: "multiple", text: "–ö–∞–∫ –≤—ã —Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å —Å–æ —Å—Ç—Ä–µ—Å—Å–æ–º?", category: "nervousness", options: [
        { text: "–°–ø–æ–∫–æ–π–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é —Å–∏—Ç—É–∞—Ü–∏—é", score: 1 },
        { text: "–ß—É–≤—Å—Ç–≤—É—é –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, –Ω–æ —Å–ø—Ä–∞–≤–ª—è—é—Å—å", score: 3 },
        { text: "–ß–∞—Å—Ç–æ —Ç–µ—Ä—è—é—Å—å", score: 5 }
      ]},
      { type: "likert", text: "–Ø —á–∞—Å—Ç–æ –∂–¥—É –ø—Ä–∏–∑–Ω–∞–Ω–∏—è —Å–≤–æ–∏—Ö –∑–∞—Å–ª—É–≥", category: "narcissism" },
      { type: "reflection", text: "–û–ø–∏—à–∏—Ç–µ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –≤—ã —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ —Å–∏–ª—å–Ω—É—é —Ç—Ä–µ–≤–æ–≥—É. –ß—Ç–æ –ø–æ–º–æ–≥–ª–æ –≤–∞–º —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è?", category: "nervousness" },
      { type: "likert", text: "–Ø –º–æ–≥—É –ª–µ–≥–∫–æ —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–º–∏ —ç–º–æ—Ü–∏—è–º–∏", category: "emotional", reverse: true },
      { type: "likert", text: "–Ø —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è –ª–∏–¥–µ—Ä–æ–º –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–∏—Ç—É–∞—Ü–∏–π", category: "narcissism" }
    ];

    let currentQuestion = 0;
    let answers = { narcissism: 0, nervousness: 0, emotional: 0 };
    let questionCount = { narcissism: 0, nervousness: 0, emotional: 0 };
    let reactionStartTime = 0;
    let reactionScores = [];
    let rankingOrder = [];
    let reflectionResponses = [];
    let selectedMood = null;

    questions.forEach(q => {
      if (q.type !== "reaction" && q.type !== "ranking" && q.type !== "reflection") {
        questionCount[q.category]++;
      }
    });

    function selectMood(mood) {
      selectedMood = mood;
      document.querySelectorAll('.mood-option').forEach(opt => opt.classList.remove('selected'));
      event.currentTarget.classList.add('selected');
    }

    function startTest() {
      const loader = document.getElementById('loader');
      loader.style.display = 'block';
      setTimeout(() => {
        loader.style.display = 'none';
        document.getElementById('start-screen').setAttribute('aria-hidden', 'true');
        document.getElementById('quiz-screen').setAttribute('aria-hidden', 'false');
        showQuestion();
      }, 1000);
    }

    function showQuestion() {
      const question = questions[currentQuestion];
      const questionEl = document.getElementById('question');
      const optionsEl = document.getElementById('options');
      const reactionTestEl = document.getElementById('reaction-test');
      const rankingEl = document.getElementById('ranking-options');
      const reflectionEl = document.getElementById('reflection-input');
      const breathingEl = document.getElementById('breathing-animation');
      const nextBtn = document.getElementById('next-btn');

      questionEl.innerHTML = `<p>${currentQuestion + 1}. ${question.text}</p>`;
      optionsEl.innerHTML = '';
      reactionTestEl.setAttribute('aria-hidden', 'true');
      rankingEl.setAttribute('aria-hidden', 'true');
      reflectionEl.setAttribute('aria-hidden', 'true');
      breathingEl.setAttribute('aria-hidden', 'true');
      nextBtn.style.display = 'none';

      if (question.type === "likert") {
        optionsEl.innerHTML = `
          <div class="option" onclick="selectOption(1)" role="radio" aria-checked="false" tabindex="0"><span>1 (–°–æ–≤—Å–µ–º –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω)</span><span class="tooltip">${question.tooltip || '–í—ã–±–µ—Ä–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–æ–≥–ª–∞—Å–Ω—ã'}</span></div>
          <div class="option" onclick="selectOption(2)" role="radio" aria-checked="false" tabindex="0"><span>2</span><span class="tooltip">${question.tooltip || '–í—ã–±–µ—Ä–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–æ–≥–ª–∞—Å–Ω—ã'}</span></div>
          <div class="option" onclick="selectOption(3)" role="radio" aria-checked="false" tabindex="0"><span>3</span><span class="tooltip">${question.tooltip || '–í—ã–±–µ—Ä–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–æ–≥–ª–∞—Å–Ω—ã'}</span></div>
          <div class="option" onclick="selectOption(4)" role="radio" aria-checked="false" tabindex="0"><span>4</span><span class="tooltip">${question.tooltip || '–í—ã–±–µ—Ä–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–æ–≥–ª–∞—Å–Ω—ã'}</span></div>
          <div class="option" onclick="selectOption(5)" role="radio" aria-checked="false" tabindex="0"><span>5 (–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å–µ–Ω)</span><span class="tooltip">${question.tooltip || '–í—ã–±–µ—Ä–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–æ–≥–ª–∞—Å–Ω—ã'}</span></div>
        `;
      } else if (question.type === "multiple") {
        question.options.forEach((opt, index) => {
          optionsEl.innerHTML += `<div class="option" onclick="selectOption(${opt.score})" role="radio" aria-checked="false" tabindex="0"><span>${opt.text}</span><span class="tooltip">${question.tooltip || '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç'}</span></div>`;
        });
      } else if (question.type === "truefalse") {
        optionsEl.innerHTML = `
          <div class="option" onclick="selectOption(${question.trueScore})" role="radio" aria-checked="false" tabindex="0"><span>–î–∞</span><span class="tooltip">${question.tooltip || '–í—ã–±–µ—Ä–∏—Ç–µ "–î–∞" –∏–ª–∏ "–ù–µ—Ç"'}</span></div>
          <div class="option" onclick="selectOption(${question.falseScore})" role="radio" aria-checked="false" tabindex="0"><span celluloid="–ù–µ—Ç" celluloid="–ù–µ—Ç"></span><span class="tooltip">${question.tooltip || '–í—ã–±–µ—Ä–∏—Ç–µ "–î–∞" –∏–ª–∏ "–ù–µ—Ç"'}</span></div>
        `;
      } else if (question.type === "reaction") {
        reactionTestEl.setAttribute('aria-hidden', 'false');
        document.getElementById('reaction-prompt').textContent = question.text;
        const reactionBtn = document.getElementById('reaction-btn');
        reactionBtn.className = 'reaction-btn';
        if (question.reactionType === "shape") {
          reactionBtn.classList.add('shape');
        }
        optionsEl.innerHTML = '';
        setTimeout(() => {
          reactionBtn.classList.add('active');
          reactionStartTime = performance.now();
        }, Math.random() * 2000 + 1000);
      } else if (question.type === "ranking") {
        rankingEl.setAttribute('aria-hidden', 'false');
        rankingEl.innerHTML = question.options.map((opt, index) => `
          <div class="ranking-option" draggable="true" data-index="${index}" role="option">${opt.text}</div>
        `).join('');
        setupRanking();
        nextBtn.style.display = 'block';
      } else if (question.type === "reflection") {
        reflectionEl.setAttribute('aria-hidden', 'false');
        reflectionEl.value = '';
        nextBtn.style.display = 'block';
      }

      if (question.category === "nervousness" && question.type !== "reaction") {
        setTimeout(() => {
          breathingEl.setAttribute('aria-hidden', 'false');
          breathingEl.style.display = 'block';
          setTimeout(() => {
            breathingEl.style.display = 'none';
          }, 8000);
        }, 1000);
      }

      const progress = document.getElementById('progress');
      const total = questions.length;
      const offset = 226 * (1 - (currentQuestion + 1) / total);
      progress.setAttribute('stroke-dashoffset', offset);
      document.getElementById('progress-text').textContent = `–ó–∞–¥–∞–Ω–∏–µ ${currentQuestion + 1} –∏–∑ ${questions.length}`;

      // Keyboard navigation
      const options = optionsEl.querySelectorAll('.option');
      options.forEach(opt => {
        opt.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            opt.click();
            e.preventDefault();
          }
        });
      });
    }

    function selectOption(score) {
      const options = document.querySelectorAll('.option');
      options.forEach(opt => {
        opt.classList.remove('selected');
        opt.setAttribute('aria-checked', 'false');
      });
      const selected = event.currentTarget;
      selected.classList.add('selected');
      selected.setAttribute('aria-checked', 'true');

      const question = questions[currentQuestion];
      if (question.type !== "reaction" && question.type !== "ranking" && question.type !== "reflection") {
        answers[question.category] += question.reverse ? (6 - score) : score;
      }
      document.getElementById('next-btn').style.display = 'block';
      document.getElementById('next-btn').focus();
    }

    function recordReaction() {
      const question = questions[currentQuestion];
      const reactionBtn = document.getElementById('reaction-btn');
      if (!reactionBtn.classList.contains('active')) return;
      const reactionTime = performance.now() - reactionStartTime;
      const score = reactionTime < 300 ? 1 : reactionTime < 600 ? 3 : 5;
      reactionScores.push(score);
      answers.nervousness += score;
      reactionBtn.classList.remove('active');
      document.getElementById('next-btn').style.display = 'block';
      document.getElementById('next-btn').focus();
    }

    function setupRanking() {
      const rankingEl = document.getElementById('ranking-options');
      const items = rankingEl.querySelectorAll('.ranking-option');
      items.forEach(item => {
        item.addEventListener('dragstart', () => item.classList.add('dragging'));
        item.addEventListener('dragend', () => item.classList.remove('dragging'));
        item.addEventListener('dragover', e => e.preventDefault());
        item.addEventListener('drop', e => {
          e.preventDefault();
          const dragged = rankingEl.querySelector('.dragging');
          const afterElement = getDragAfterElement(rankingEl, e.clientY);
          if (afterElement == null) {
            rankingEl.appendChild(dragged);
          } else {
            rankingEl.insertBefore(dragged, afterElement);
          }
        });
      });
    }

    function getDragAfterElement(container, y) {
      const draggableElements = [...container.querySelectorAll('.ranking-option:not(.dragging)')];
      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if (offset < 0 && offset > closest.offset) {
          return { offset: offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    function nextQuestion() {
      const question = questions[currentQuestion];
      if (question.type === "ranking") {
        const rankingEl = document.getElementById('ranking-options');
        const items = rankingEl.querySelectorAll('.ranking-option');
        let score = 0;
        items.forEach((item, index) => {
          const originalIndex = parseInt(item.getAttribute('data-index'));
          score += question.options[originalIndex].score * (items.length - index);
        });
        answers[question.category] += score / items.length;
      } else if (question.type === "reflection") {
        const response = document.getElementById('reflection-input').value.trim();
        if (response) {
          const score = response.length > 100 ? 5 : response.length > 50 ? 3 : 1;
          answers[question.category] += score;
          reflectionResponses.push({ question: question.text, response });
        }
      }

      currentQuestion++;
      if (currentQuestion < questions.length) {
        showQuestion();
      } else {
        showResults();
      }
    }

    function showResults() {
      const loader = document.getElementById('loader');
      loader.style.display = 'block';
      setTimeout(() => {
        loader.style.display = 'none';
        document.getElementById('quiz-screen').setAttribute('aria-hidden', 'true');
        document.getElementById('result-screen').setAttribute('aria-hidden', 'false');
        launchConfetti();
      }, 1000);

      const narcissismScore = (answers.narcissism / (questionCount.narcissism * 5)) * 100;
      const nervousnessScore = ((answers.nervousness + (reactionScores.reduce((a, b) => a + b, 0) || 0)) / ((questionCount.nervousness + reactionScores.length) * 5)) * 100;
      const emotionalScore = (answers.emotional / (questionCount.emotional * 5)) * 100;

      const narcissismLevel = narcissismScore < 40 ? '–ù–∏–∑–∫–∏–π' : narcissismScore < 70 ? '–°—Ä–µ–¥–Ω–∏–π' : '–í—ã—Å–æ–∫–∏–π';
      const nervousnessLevel = nervousnessScore < 40 ? '–ù–∏–∑–∫–∞—è' : nervousnessScore < 70 ? '–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è' : '–¢—Ä–µ–≤–æ–∂–Ω–∞—è';
      const emotionalLevel = emotionalScore < 40 ? '–°—Ç–∞–±–∏–ª—å–Ω—ã–π' : emotionalScore < 70 ? '–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π' : '–ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω';

      let moodRecommendation = '';
      if (selectedMood === 'üòä') {
        moodRecommendation = '–í–∞—à–µ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —É—Å–∏–ª–∏–≤–∞–µ—Ç –≤–∞—à–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —ç—Ç–æ—Ç –Ω–∞—Å—Ç—Ä–æ–π!';
      } else if (selectedMood === 'üòê') {
        moodRecommendation = '–í–∞—à–µ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Ö –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–æ—Å—Ç–∞.';
      } else if (selectedMood === 'üòî') {
        moodRecommendation = '–í–∞—à–µ —Ç–µ–∫—É—â–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ç–µ—Ö–Ω–∏–∫–∏ —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏ –∏ –∑–∞–±–æ—Ç—ã –æ —Å–µ–±–µ.';
      }

      document.getElementById('results').innerHTML = `
        <div class="result-block">
          <h3>–£—Ä–æ–≤–µ–Ω—å –Ω–∞—Ä—Ü–∏—Å—Å–∏–∑–º–∞: ${narcissismLevel} (${Math.round(narcissismScore)}%)</h3>
          <div class="result-bar narcissism" style="width: ${narcissismScore}%"></div>
          <p class="recommendation">${getRecommendation('narcissism', narcissismLevel)}</p>
        </div>
        <div class="result-block">
          <h3>–ù–µ—Ä–≤–æ–∑–Ω–æ—Å—Ç—å: ${nervousnessLevel} (${Math.round(nervousnessScore)}%)</h3>
          <div class="result-bar nervousness" style="width: ${nervousnessScore}%"></div>
          <p class="recommendation">${getRecommendation('nervousness', nervousnessLevel)}</p>
        </div>
        <div class="result-block">
          <h3>–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: ${emotionalLevel} (${Math.round(emotionalScore)}%)</h3>
          <div class="result-bar emotional" style="width: ${emotionalScore}%"></div>
          <p class="recommendation">${getRecommendation('emotional', emotionalLevel)}</p>
        </div>
        ${moodRecommendation ? `<div class="result-block"><h3>–í–∞—à–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</h3><p>${moodRecommendation}</p></div>` : ''}
        <div class="result-block">
          <h3>–í–∞—à–∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏</h3>
          <p>${reflectionResponses.length > 0 ? reflectionResponses.map(r => `<strong>${r.question}</strong><br>${r.response}`).join('<br><br>') : '–í—ã –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª–∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤.'}</p>
        </div>
      `;

      drawRadarChart(narcissismScore, nervousnessScore, emotionalScore);
    }

    function getRecommendation(category, level) {
      const recommendations = {
        narcissism: {
          –ù–∏–∑–∫–∏–π: '–í—ã –ø—Ä–æ—è–≤–ª—è–µ—Ç–µ –∑–¥–æ—Ä–æ–≤—É—é —Å–∫—Ä–æ–º–Ω–æ—Å—Ç—å –∏ —É–≤–∞–∂–µ–Ω–∏–µ –∫ –æ–∫—Ä—É–∂–∞—é—â–∏–º. –í–∞—à–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Ü–µ–Ω–∏—Ç—å –¥—Ä—É–≥–∏—Ö –¥–µ–ª–∞–µ—Ç –≤–∞—Å –æ—Ç–ª–∏—á–Ω—ã–º –∫–æ–º–∞–Ω–¥–Ω—ã–º –∏–≥—Ä–æ–∫–æ–º. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Ä–∞–∑–≤–∏–≤–∞—Ç—å —ç–º–ø–∞—Ç–∏—é –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≥–∞—Ä–º–æ–Ω–∏—á–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è.',
          –°—Ä–µ–¥–Ω–∏–π: '–£ –≤–∞—Å –∑–¥–æ—Ä–æ–≤–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ–±–µ, –Ω–æ –∏–Ω–æ–≥–¥–∞ –≤—ã –º–æ–∂–µ—Ç–µ —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è –∫ –≤–Ω–µ—à–Ω–µ–º—É –ø—Ä–∏–∑–Ω–∞–Ω–∏—é. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –∏ –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ–∫—Ä—É–∂–∞—é—â–∏—Ö.',
          –í—ã—Å–æ–∫–∏–π: '–í–∞—à–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –∑–∞–º–µ—Ç–Ω–∞ –∏ –º–æ–∂–µ—Ç –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å, –Ω–æ –∏–Ω–æ–≥–¥–∞ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ —ç–≥–æ—Ü–µ–Ω—Ç—Ä–∏—á–Ω–æ—Å—Ç—å. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º —Ä–∞–∑–≤–∏–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–ª—É—à–∞–Ω–∏–µ –∏ –±–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è —É–¥–µ–ª—è—Ç—å —á—É–≤—Å—Ç–≤–∞–º –¥—Ä—É–≥–∏—Ö.'
        },
        nervousness: {
          –ù–∏–∑–∫–∞—è: '–í—ã –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç–µ –≤–ø–µ—á–∞—Ç–ª—è—é—â—É—é —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Å—Ç—Ä–µ—Å—Å—É, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –¥–∞–∂–µ –≤ —Å–ª–æ–∂–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö. –≠—Ç–æ –≤–∞—à –º–æ—â–Ω—ã–π —Ä–µ—Å—É—Ä—Å –¥–ª—è –º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è!',
          –ü–æ–≤—ã—à–µ–Ω–Ω–∞—è: '–ò–Ω–æ–≥–¥–∞ –≤—ã –æ—â—É—â–∞–µ—Ç–µ —Ç—Ä–µ–≤–æ–≥—É, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–µ–π. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ç–µ—Ö–Ω–∏–∫–∏ —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ –≥–ª—É–±–æ–∫–æ–µ –¥—ã—Ö–∞–Ω–∏–µ, –º–µ–¥–∏—Ç–∞—Ü–∏—è –∏–ª–∏ –ø—Ä–æ–≥—É–ª–∫–∏ –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ, —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.',
          –¢—Ä–µ–≤–æ–∂–Ω–∞—è: '–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏ –º–æ–∂–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –≤–∞—à–µ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –ø—Å–∏—Ö–æ–ª–æ–≥—É –∏–ª–∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø—Ä–∞–∫—Ç–∏–∫–∏ mindfulness, –π–æ–≥—É –∏–ª–∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–µ—Å—Å–æ–º.'
        },
        emotional: {
          –°—Ç–∞–±–∏–ª—å–Ω—ã–π: '–í—ã –æ—Ç–ª–∏—á–Ω–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Å–≤–æ–∏–º–∏ —ç–º–æ—Ü–∏—è–º–∏, —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å –∂–∏–∑–Ω–µ–Ω–Ω—ã–º–∏ –≤—ã–∑–æ–≤–∞–º–∏. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —ç—Ç–æ—Ç –±–∞–ª–∞–Ω—Å —á–µ—Ä–µ–∑ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å –∏ –∑–∞–±–æ—Ç—É –æ —Å–µ–±–µ.',
          –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π: '–í–∞—à–∏ —ç–º–æ—Ü–∏–∏ –∏–Ω–æ–≥–¥–∞ –∫–æ–ª–µ–±–ª—é—Ç—Å—è, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å–æ —Å—Ç—Ä–µ—Å—Å–æ–º. –ü—Ä–∞–∫—Ç–∏–∫–∏ –≤–µ–¥–µ–Ω–∏—è –¥–Ω–µ–≤–Ω–∏–∫–∞, –º–µ–¥–∏—Ç–∞—Ü–∏–∏ –∏–ª–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã —Å –±–ª–∏–∑–∫–∏–º–∏ –ø–æ–º–æ–≥—É—Ç —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.',
          –ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω: '–í–∞—à–∏ —ç–º–æ—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–º–∏ –∏ –∏–Ω–æ–≥–¥–∞ –≤—ã—Ö–æ–¥–∏—Ç—å –∏–∑-–ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª—è. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤—ã–¥–µ–ª—è—Ç—å –≤—Ä–µ–º—è –¥–ª—è –æ—Ç–¥—ã—Ö–∞, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ —Å –ø—Å–∏—Ö–æ–ª–æ–≥–æ–º –∏ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∑–∞–±–æ—Ç—ã –æ —Å–µ–±–µ, —Ç–∞–∫–∏–µ –∫–∞–∫ —Ö–æ–±–±–∏ –∏–ª–∏ —Ä–µ–ª–∞–∫—Å–∞—Ü–∏—è.'
        }
      };
      return recommendations[category][level];
    }

    function drawRadarChart(narcissism, nervousness, emotional) {
      const canvas = document.getElementById('result-chart');
      const ctx = canvas.getContext('2d');
      canvas.width = 600;
      canvas.height = 400;

      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = 150;

      // Draw radar background
      ctx.beginPath();
      ctx.moveTo(centerX, centerY - radius);
      ctx.lineTo(centerX + radius * Math.cos(2 * Math.PI / 3), centerY + radius * Math.sin(2 * Math.PI / 3));
      ctx.lineTo(centerX + radius * Math.cos(4 * Math.PI / 3), centerY + radius * Math.sin(4 * Math.PI / 3));
      ctx.closePath();
      ctx.strokeStyle = '#e2e8f0';
      ctx.lineWidth = 2;
      ctx.stroke();

      // Draw data
      const narcRad = (narcissism / 100) * radius;
      const nervRad = (nervousness / 100) * radius;
      const emoRad = (emotional / 100) * radius;

      ctx.beginPath();
      ctx.moveTo(centerX, centerY - narcRad);
      ctx.lineTo(centerX + nervRad * Math.cos(2 * Math.PI / 3), centerY + nervRad * Math.sin(2 * Math.PI / 3));
      ctx.lineTo(centerX + emoRad * Math.cos(4 * Math.PI / 3), centerY + emoRad * Math.sin(4 * Math.PI / 3));
      ctx.closePath();
      ctx.fillStyle = 'rgba(159, 122, 234, 0.3)';
      ctx.fill();
      ctx.strokeStyle = '#9f7aea';
      ctx.stroke();

      // Labels
      ctx.fillStyle = '#2d3748';
      ctx.font = '16px Inter';
      ctx.textAlign = 'center';
      ctx.fillText('–ù–∞—Ä—Ü–∏—Å—Å–∏–∑–º', centerX, centerY - radius - 20);
      ctx.fillText('–ù–µ—Ä–≤–æ–∑–Ω–æ—Å—Ç—å', centerX + radius * Math.cos(2 * Math.PI / 3) + 60, centerY + radius * Math.sin(2 * Math.PI / 3));
      ctx.fillText('–≠–º–æ—Ü–∏–∏', centerX + radius * Math.cos(4 * Math.PI / 3) - 60, centerY + radius * Math.sin(4 * Math.PI / 3));

      // Percentage markers
      ctx.font = '12px Inter';
      for (let i = 20; i <= 100; i += 20) {
        const r = (i / 100) * radius;
        ctx.beginPath();
        ctx.arc(centerX, centerY, r, 0, 2 * Math.PI);
        ctx.strokeStyle = '#e2e8f0';
        ctx.stroke();
        ctx.fillText(`${i}%`, centerX, centerY - r - 10);
      }
    }

    function exportResults() {
      const results = document.getElementById('results').innerHTML;
      const blob = new Blob([`
        <!DOCTYPE html>
        <html lang="ru">
        <head>
          <meta charset="UTF-8">
          <style>
            body { font-family: Arial, sans-serif; padding: 20px; }
            h1 { color: #2d3748; }
            .result-block { margin: 20px 0; padding: 15px; background: #f7fafc; border-radius: 10px; }
            h3 { color: #2d3748; }
            .recommendation { color: #4a5568; }
          </style>
        </head>
        <body>
          <h1>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∞</h1>
          ${results}
        </body>
        </html>
      `], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'Psychological_Test_Results.html';
      a.click();
      URL.revokeObjectURL(url);
    }

    function shareResults() {
      const results = document.getElementById('results').innerText;
      const shareText = `–ú–æ–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∞:\n${results}\n–ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç –Ω–∞ https://example.com!`;
      navigator.clipboard.writeText(shareText).then(() => {
        alert('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
      });
    }

    function launchConfetti() {
      const canvas = document.createElement('canvas');
      canvas.style.position = 'fixed';
      canvas.style.top = '0';
      canvas.style.left = '0';
      canvas.style.width = '100%';
      canvas.style.height = '100%';
      canvas.style.pointerEvents = 'none';
      document.body.appendChild(canvas);
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const ctx = canvas.getContext('2d');
      const particles = [];
      for (let i = 0; i < 50; i++) {
        particles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          size: Math.random() * 5 + 2,
          speedX: Math.random() * 3 - 1.5,
          speedY: Math.random() * 3 - 1.5,
          color: ['#9f7aea', '#4299e1', '#b794f4'][Math.floor(Math.random() * 3)]
        });
      }

      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => {
          ctx.fillStyle = p.color;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fill();
          p.x += p.speedX;
          p.y += p.speedY;
          p.size *= 0.98;
        });
        if (particles[0].size > 0.1) {
          requestAnimationFrame(animate);
        } else {
          document.body.removeChild(canvas);
        }
      }
      animate();
    }

    function restartTest() {
      const loader = document.getElementById('loader');
      loader.style.display = 'block';
      setTimeout(() => {
        loader.style.display = 'none';
        currentQuestion = 0;
        answers = { narcissism: 0, nervousness: 0, emotional: 0 };
        reactionScores = [];
        rankingOrder = [];
        reflectionResponses = [];
        selectedMood = null;
        document.getElementById('result-screen').setAttribute('aria-hidden', 'true');
        document.getElementById('start-screen').setAttribute('aria-hidden', 'false');
      }, 1000);
    }

    // Keyboard navigation for start button and mood tracker
    document.querySelectorAll('.btn, .mood-option').forEach(el => {
      el.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          el.click();
        }
      });
    });
  </script>
</body>
</html>
